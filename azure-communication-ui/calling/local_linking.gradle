// Detect Local Linking

// Set TARGET_ABI, defaulting to x86_64
def targetAbi = 'x86_64'

// Define empty variables for holding paths to .aar files and their directories
ext.alphaLib = null
ext.alphaDir = null
ext.betaLib = null
ext.betaDir = null
ext.gaLib = null
ext.gaDir = null

// List of stages
def stages = ['ALPHA', 'BETA', 'GA']

// Loop over stages and check if the file exists
stages.each { stage ->
    def path = "../../../staging.d/release/${stage}/sdk/${targetAbi}"
    if (file(path).exists()) {
        def aarFile = fileTree(path).find { it.name.endsWith('.aar') }
        if (aarFile) {
            def fileNameWithoutExtension = aarFile.name.take(aarFile.name.lastIndexOf('.'))
            switch(stage) {
                case 'ALPHA':
                    alphaLib = fileNameWithoutExtension
                    alphaDir = aarFile.parent
                    break
                case 'BETA':
                    betaLib = fileNameWithoutExtension
                    betaDir = aarFile.parent
                    break
                case 'GA':
                    gaLib = fileNameWithoutExtension
                    gaDir = aarFile.parent
                    break
            }
        }
    }
}

// Define ANSI colors
def ANSI_RESET = "\u001B[0m"
def ANSI_RED = "\u001B[31m"
def ANSI_GREEN = "\u001B[32m"
def ANSI_BLUE = "\u001B[34m"
def ANSI_BLACK = "\u001B[30m"
def ANSI_WHITE_BACKGROUND = "\u001B[47m"

// Output header
println "${ANSI_BLACK}${ANSI_WHITE_BACKGROUND}---=== Calling SDK Local Linking Status ===---${ANSI_RESET}"

// Output the detected libraries with colors
println "${ANSI_BLUE}Target ABI: ${targetAbi}${ANSI_RESET}"
println "${alphaLib != null ? ANSI_GREEN : ANSI_RED}Alpha Lib: ${alphaLib} at ${alphaDir}${ANSI_RESET}"
println "${betaLib != null ? ANSI_GREEN : ANSI_RED}Beta Lib: ${betaLib} at ${betaDir}${ANSI_RESET}"
println "${gaLib != null ? ANSI_GREEN : ANSI_RED}GA Lib: ${gaLib} at ${gaDir}${ANSI_RESET}"

// Set the properties to be used later in the build script
ext.hasLocalAlpha = alphaLib != null
ext.hasLocalBeta = betaLib != null
ext.hasLocalGA = gaLib != null
